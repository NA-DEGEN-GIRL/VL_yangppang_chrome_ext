# Hedge Trading Helper - Chrome Extension

Lighter와 Variational 거래소에서 동시에 반대 포지션(헤지) 주문을 실행하고 실시간 포지션 정보를 모니터링하는 Chrome 확장 프로그램입니다.

## 🎯 목표

두 거래소 간의 가격 차이를 이용한 차익 거래 또는 헤지 트레이딩 전략 실행 시, 수동 작업을 최소화하고 빠른 주문 실행을 지원합니다.

## ✨ 주요 기능

### 📊 실시간 모니터링
- **포지션 정보**: 각 거래소의 포지션 크기를 소수점 4자리까지 실시간 표시
- **손익 현황**: 미실현 손익(PnL)과 펀딩 수수료를 소수점 1자리까지 표시
- **계좌 잔액**: 각 거래소별 잔액 및 총 합계를 USD 형식($X,XXX.XX)으로 표시
- **자동 갱신**: 모든 정보가 1초마다 자동으로 업데이트

### 🚀 주문 실행
- **동시 수량 설정**: 한 번의 입력으로 두 거래소에 동일한 주문 수량 설정
- **헤지 포지션 실행**: 
  - `L-Buy, V-Sell`: Lighter 매수(Long) + Variational 매도(Short)
  - `L-Sell, V-Buy`: Lighter 매도(Short) + Variational 매수(Long)
- **Lighter 오더북 연동**: 
  - `X (Off)`: 시장가(Market) 주문 실행
  - `0-10`: 선택한 번호의 오더북 가격으로 지정가 주문
    - Buy 시: 선택한 번호의 bid 가격 클릭
    - Sell 시: 역순으로 ask 가격 클릭 (0 선택 시 → ask-10 클릭)
  - **자동 가격 업데이트**: 오더북 가격을 주기적으로 자동 클릭하여 최신 가격 유지
    - 업데이트 주기: 100ms ~ 5000ms (기본값: 200ms)
    - Start/Stop 버튼으로 제어 가능
- **개별 주문 제출**: 
  - `Submit L`: Lighter 거래소만 주문 실행
  - `Submit V`: Variational 거래소만 주문 실행
  - `Submit ALL Orders`: 두 거래소 동시 주문 실행

### 🔧 편의 기능
- **거래 페어 변경**: 코인 심볼(ETH, SOL 등) 입력 후 `Set` 버튼으로 두 거래소 페이지 동시 전환
- **측면 패널 지원**: Chrome 측면 패널에서도 사용 가능 (우클릭 메뉴)

## 📂 프로젝트 구조

```
hedge-trading-helper/
├── manifest.json          # Chrome 확장 프로그램 설정
├── popup.html            # 사용자 인터페이스
├── popup.js              # UI 이벤트 처리 및 데이터 표시
├── background.js         # 백그라운드 작업 및 탭 간 통신
├── lighter.js            # Lighter 거래소 DOM 조작 스크립트
├── variational.js        # Variational 거래소 DOM 조작 스크립트
├── README.md             # 프로젝트 문서
└── images/
    └── icon128.png       # 확장 프로그램 아이콘
```

### 📋 각 파일의 역할

- **`manifest.json`**: 확장 프로그램의 권한, 스크립트, 아이콘 등을 정의
- **`popup.html/js`**: 사용자가 상호작용하는 UI와 실시간 데이터 표시 로직
- **`background.js`**: 거래소 탭을 찾고, 스크립트를 주입하며, 메시지를 중계하는 백그라운드 서비스
- **`lighter.js`**: Lighter 거래소 페이지에서 수량 입력, 버튼 클릭, 데이터 수집 등을 수행
- **`variational.js`**: Variational 거래소 페이지에서 동일한 작업 수행

## 🚀 설치 방법

1. **소스 코드 다운로드**
   ```bash
   git clone [repository-url]
   cd hedge-trading-helper
   ```

2. **Chrome 브라우저에서 확장 프로그램 페이지 열기**
   - 주소창에 `chrome://extensions` 입력
   - 또는 메뉴 → 도구 더보기 → 확장 프로그램

3. **개발자 모드 활성화**
   - 페이지 우측 상단의 "개발자 모드" 토글 ON

4. **확장 프로그램 로드**
   - "압축해제된 확장 프로그램을 로드합니다" 클릭
   - 다운로드한 프로젝트 폴더 선택

5. **툴바에 고정**
   - 브라우저 우측 상단의 퍼즐 아이콘 클릭
   - Hedge Trading Helper 옆의 핀 아이콘 클릭하여 고정

## 📖 사용 가이드

### 사전 준비
1. **거래소 탭 열기**
   - Lighter: `https://app.lighter.xyz/trade/BTC`
   - Variational: `https://omni.variational.io/perpetual/BTC`
   - 각 거래소당 **하나의 탭만** 열어야 함
   - 두 거래소 모두 로그인 필요

2. **확장 프로그램 실행**
   - 툴바의 확장 프로그램 아이콘 클릭
   - 팝업창이 열리면서 실시간 정보 표시 시작

### 주문 실행 단계

1. **거래 페어 설정**
   ```
   Coin Symbol: [ETH] [Set]
   ```
   - 원하는 코인 심볼 입력 후 Set 버튼 클릭
   - 두 거래소 페이지가 해당 코인으로 자동 전환

2. **수량 입력**
   ```
   Quantity: [0.001]
   ```
   - 거래할 수량 입력 (두 거래소 동일 적용)

3. **오더북 설정 (Lighter 전용)**
   ```
   Lighter Orderbook: [X (Off) ▼]
   Auto-refresh: [200] ms [Start]
   ```
   - `X`: 시장가 주문
   - `0`: 최우선 호가 (Best bid/ask)
   - `1-10`: 호가창 깊이별 가격 선택
   - **Auto-refresh**: 오더북 선택 시 자동 가격 업데이트
     - 주기 설정: 100-5000ms
     - Start/Stop 버튼으로 제어

4. **포지션 방향 선택 및 실행**
   ```
   [L-Buy, V-Sell] [L-Sell, V-Buy]
   ```
   - 원하는 헤지 방향 버튼 클릭

5. **주문 제출**
   ```
   [Submit ALL Orders]
   [Submit L] [Submit V]
   ```
   - ALL: 두 거래소 동시 실행
   - L/V: 개별 거래소 실행 (한쪽 실패 시 재시도용)

### 오더북 자동 업데이트 사용법
1. 오더북 인덱스를 선택 (0-10 중 하나)
2. L-Buy/V-Sell 또는 L-Sell/V-Buy 버튼을 클릭하여 방향 설정
3. Auto-refresh 주기를 설정 (기본값: 200ms)
4. Start 버튼을 클릭하여 자동 업데이트 시작
5. Stop 버튼으로 언제든지 중지 가능

### 측면 패널 사용법
1. 확장 프로그램 아이콘 **우클릭**
2. "측면 패널에서 열기" 선택
3. Chrome 브라우저 우측에 패널로 고정되어 표시

## ⚠️ 주의사항

### 거래소 웹사이트 변경 대응
거래소가 UI를 업데이트하면 확장 프로그램이 작동하지 않을 수 있습니다.

**DOM 선택자 수정 방법:**
1. 해당 거래소 페이지에서 `F12` (개발자 도구)
2. Elements 탭에서 요소 선택 도구(화살표 아이콘) 클릭
3. 페이지에서 문제가 되는 요소 클릭
4. `data-testid`, `class`, `id` 등 확인
5. `lighter.js` 또는 `variational.js`의 선택자 수정

**예시:**
```javascript
// 기존
document.querySelector('[data-testid="old-button"]')
// 수정
document.querySelector('[data-testid="new-button"]')
```

### 안전한 사용을 위한 권고사항
- ⚠️ 실제 거래 전 **테스트넷**이나 **소액**으로 충분히 테스트
- ⚠️ 중요한 거래 시 거래소 화면 직접 확인
- ⚠️ 네트워크 지연이나 거래소 점검 시간 확인
- ⚠️ 개인 키나 API 키는 절대 확장 프로그램에 입력하지 않음
- ⚠️ 자동 업데이트 사용 시 너무 짧은 주기는 서버 부하 유발 가능

## 🐛 문제 해결

### 포지션 정보가 0으로 표시
- 거래소 탭이 열려있는지 확인
- 페이지가 완전히 로드되었는지 확인 (새로고침 필요할 수 있음)
- 로그인 상태 확인

### 주문이 실행되지 않음
- 거래 가능 잔액 확인
- 마진 레벨 확인
- 최소 주문 수량 확인
- 콘솔 에러 확인: `F12` → Console 탭

### 버튼 클릭이 작동하지 않음
- DOM 선택자가 최신인지 확인 (위 "DOM 선택자 수정 방법" 참조)
- 거래소 페이지 새로고침 후 재시도

### 자동 업데이트가 작동하지 않음
- 오더북 인덱스가 'X'가 아닌지 확인
- L-Buy/V-Sell 또는 L-Sell/V-Buy 버튼을 먼저 클릭했는지 확인
- 너무 짧은 주기(100ms 미만)는 동작하지 않을 수 있음

## 🔄 업데이트 내역

### v1.5 (현재)
- 오더북 가격 자동 업데이트 기능 추가
- 업데이트 주기 사용자 설정 가능 (100-5000ms)
- Start/Stop 토글 버튼으로 제어

### v1.4
- 오더북 인덱스 버그 수정 (0-10 범위로 정정)
- 실시간 포지션 모니터링 기능 추가
- PnL 및 Funding Fee 표시
- 계좌 잔액 합산 표시
- 시장가/지정가 주문 자동 전환

## 📜 라이선스

MIT License - 자유롭게 사용, 수정, 배포 가능